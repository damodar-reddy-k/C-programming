#include <stdio.h>
#include <string.h>
#include <stdbool.h>
#include <ctype.h>
#include <stdlib.h>
#include "autocorrect.h"

// Word frequnecy data file
#define WORD_DATA "../autocorrect-lib/data-files/word_data.txt"

int main(int argc, char* argv[])
{
    // Load word frequency data from file into trie
    if (!AUTOCORR_upload())
    {
        printf("Error loading word data. Autocorrect could not be initialized.\n");
        return 1;
    }

    // Get user input
    char input[AUTOCORR_LENGTH_MAX + 1];
    if (argc != 2)
    {
        printf("Enter a word to autocorrect: ");
        if (fgets(input, AUTOCORR_LENGTH_MAX + 1, stdin) == NULL)
        {
            printf("Error reading input. Exiting...\n");
            AUTOCORR_unload_words();
            return 1;
        }
    }
    else
    {
        strncpy(input, argv[1], AUTOCORR_LENGTH_MAX);
        input[AUTOCORR_LENGTH_MAX] = '\0';
    }

    // Remove newline character from input
    input[strcspn(input, "\n")] = '\0';

    // Check if the word is present in the dictionary
    int word_freq = AUTOCORR_check_word(input);
    if (word_freq > 0)
    {
        printf("\n%s is a correct spelling.\n", input);
    }
    else
    {
        // Correct the input word
        char* corrected_word = AUTOCORR_correct_word(input);
        if (corrected_word == NULL)
        {
            printf("\n%s is a wrong spelling or not present in the dictionary.\n", input);
        }
        else
        {
            printf("\nCorrected word: '%s'\n", corrected_word);
            free(corrected_word);
        }
    }

    // Unload the word data from memory
    AUTOCORR_unload_words();

    return 0;
}